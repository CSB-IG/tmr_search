
setwd("~/MARINa")

library(ssmarina)
library(mixtools)

library(limma)

# Expression data
dset <- read.table('./validation_analisys/GSE4611/metanormalizados.txt',header=TRUE,row.names=1)
dset <- as.matrix(dset)
head(dset)
length(dset)

save(dset,file="./validation_analisys/GSE4611/dset_GSE4611.Rdata")

# Groups list

enfermos <- c('GSM103115', 'GSM103116', 'GSM103117', 'GSM103118', 'GSM103119', 'GSM103120', 'GSM103121', 'GSM103122', 'GSM103123', 'GSM103124', 'GSM103125', 'GSM103126', 'GSM103127', 'GSM103128', 'GSM103129', 'GSM103130', 'GSM103131', 'GSM103132', 'GSM103133', 'GSM103134', 'GSM103135', 'GSM103136', 'GSM103137', 'GSM103138', 'GSM103139', 'GSM103140', 'GSM103141', 'GSM103142', 'GSM103143', 'GSM103144', 'GSM103145', 'GSM103146', 'GSM103147', 'GSM103148', 'GSM103149', 'GSM103150', 'GSM103151', 'GSM103152', 'GSM103153', 'GSM103154', 'GSM103155', 'GSM103156', 'GSM103157', 'GSM103158', 'GSM103159', 'GSM103160', 'GSM103161', 'GSM103162', 'GSM103163', 'GSM103164', 'GSM103165', 'GSM103166', 'GSM103167', 'GSM103168', 'GSM103169', 'GSM103170', 'GSM103171', 'GSM103172', 'GSM103173', 'GSM103174', 'GSM103175', 'GSM103176', 'GSM103177', 'GSM103178', 'GSM103179', 'GSM103180', 'GSM103181', 'GSM103182', 'GSM103183', 'GSM103184', 'GSM103185', 'GSM103186', 'GSM103187', 'GSM103188', 'GSM103189', 'GSM103190', 'GSM103191', 'GSM103192', 'GSM103193', 'GSM103194', 'GSM103195', 'GSM103196', 'GSM103197', 'GSM103198', 'GSM103199', 'GSM103200', 'GSM103201', 'GSM103202', 'GSM103203', 'GSM103204', 'GSM103205', 'GSM103206', 'GSM103207', 'GSM103208', 'GSM103209', 'GSM103210', 'GSM103211', 'GSM103212', 'GSM103213', 'GSM103214', 'GSM103215', 'GSM103216', 'GSM103217', 'GSM103218', 'GSM103219', 'GSM103220', 'GSM103221', 'GSM103222', 'GSM103223', 'GSM103224', 'GSM103225', 'GSM103226', 'GSM103227', 'GSM103228', 'GSM103229', 'GSM103230', 'GSM103231', 'GSM103232', 'GSM103233', 'GSM103234', 'GSM103235', 'GSM103236', 'GSM103237', 'GSM103238', 'GSM103239', 'GSM103240', 'GSM103241', 'GSM103242', 'GSM103243', 'GSM103244', 'GSM103245', 'GSM103246', 'GSM103247', 'GSM103248', 'GSM103249', 'GSM103250', 'GSM103251', 'GSM103252', 'GSM103253', 'GSM103254', 'GSM103255', 'GSM103256', 'GSM103257', 'GSM103258', 'GSM103259', 'GSM103260', 'GSM103261', 'GSM103262', 'GSM103263', 'GSM103264', 'GSM103265', 'GSM103266', 'GSM103267', 'GSM103268', 'GSM103269', 'GSM103270', 'GSM103272', 'GSM103273', 'GSM103274', 'GSM103275', 'GSM103276', 'GSM103277', 'GSM103278', 'GSM103279', 'GSM103280', 'GSM103281', 'GSM103282', 'GSM103284', 'GSM103285', 'GSM1123734', 'GSM1123735', 'GSM1123736', 'GSM1123737', 'GSM1123738', 'GSM1123739', 'GSM1123740', 'GSM1123741', 'GSM1123742', 'GSM1123743', 'GSM1123744', 'GSM1123745', 'GSM1123746', 'GSM1123747', 'GSM1123748', 'GSM1123749', 'GSM1123750', 'GSM1123751', 'GSM1123752', 'GSM1123753', 'GSM1123754', 'GSM1123755', 'GSM1123756', 'GSM1123757', 'GSM1123758', 'GSM1123759', 'GSM1123760', 'GSM1123761', 'GSM1123762', 'GSM1123763', 'GSM1123764', 'GSM1123765', 'GSM1123766', 'GSM1123767', 'GSM1123768', 'GSM1123769', 'GSM1123770', 'GSM1123771', 'GSM1123772', 'GSM1123773', 'GSM1123774', 'GSM1123775', 'GSM1123776', 'GSM1123777', 'GSM1123778', 'GSM1123779', 'GSM1123780')
sanos <- c('GSM512539', 'GSM512540', 'GSM512541', 'GSM512542', 'GSM512543', 'GSM512544', 'GSM512545', 'GSM512546', 'GSM512547', 'GSM512548', 'GSM512549', 'GSM512550', 'GSM512551', 'GSM512552', 'GSM512553', 'GSM512554', 'GSM512555', 'GSM512556', 'GSM1589130', 'GSM1589132', 'GSM1589135', 'GSM1589136', 'GSM1589139', 'GSM1589142', 'GSM1589144', 'GSM1589145', 'GSM1589148', 'GSM1589150', 'GSM1589151')
grupos <- list(sanos=sanos,enfermos=enfermos)

# Expresion matrix separation
sanMuest <- which(colnames(dset) %in% grupos[["sanos"]])
enfMuest <- which(colnames(dset) %in% grupos[["enfermos"]])

design = matrix(rep(0,490), nrow=245)
colnames(design) = c("enf","san")

design[enfMuest,1]=1
design[sanMuest,2]=1

cont.matrix = makeContrasts("enf - san", levels=design)


########  S I G N A T U R E ######## 

# Row by row T test comparation of the two matrix
signature <- rowTtest(dset[, enfMuest], dset[, sanMuest])

# z-score values for the GES
signature <- (qnorm(signature$p.value/2, lower.tail=F) * sign(signature$statistic))[,1]


########  N U L L  M O D E L ######## 

# NULL model by sample permutation

nullmodel <- ttestNull(dset[, enfMuest], dset[, sanMuest], per=1000, repos=T)


save.image("./validation_analisys/GSE4611/general_GSE4611.Rdata")
